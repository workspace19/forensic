<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charon - Digital Forensics Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .app-header {
            background: linear-gradient(135deg, #2d2d2d, #1a1a1a);
            padding: 15px 20px;
            border-bottom: 2px solid #404040;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .app-title {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .version-info {
            color: #666;
            font-size: 14px;
        }

        .menu-bar {
            background: linear-gradient(135deg, #333333, #2a2a2a);
            padding: 10px 20px;
            border-bottom: 1px solid #404040;
            font-size: 14px;
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.1);
        }

        .menu-items {
            display: flex;
            gap: 30px;
        }

        .menu-item {
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-item:hover {
            background: linear-gradient(135deg, #444444, #555555);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 160px);
        }

        .left-panel {
            width: 320px;
            background: linear-gradient(180deg, #252525, #1f1f1f);
            border-right: 2px solid #404040;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
        }

        .panel-header {
            background: linear-gradient(135deg, #2d2d2d, #252525);
            padding: 12px 15px;
            font-weight: 600;
            border-bottom: 1px solid #404040;
            font-size: 14px;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .tree-item {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            font-size: 13px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .tree-item:hover {
            background: linear-gradient(135deg, #333333, #2a2a2a);
            border-color: #555;
            transform: translateX(5px);
        }

        .tree-item.selected {
            background: linear-gradient(135deg, #0066cc, #004499);
            border-color: #0099ff;
            box-shadow: 0 2px 10px rgba(0, 102, 204, 0.4);
            transform: translateX(8px);
        }

        .tree-item.deleted {
            color: #ff6b6b;
            border-color: #ff6b6b33;
        }

        .tree-icon {
            margin-right: 10px;
            font-size: 16px;
            filter: drop-shadow(0 0 3px currentColor);
        }

        .tree-indent {
            margin-left: 25px;
        }

        .center-panel {
            flex: 1;
            background: linear-gradient(180deg, #1e1e1e, #181818);
            display: flex;
            flex-direction: column;
            border-right: 2px solid #404040;
        }

        .file-format-section {
            background: linear-gradient(135deg, #252525, #1f1f1f);
            border-bottom: 2px solid #404040;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .format-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .format-card {
            background: linear-gradient(135deg, #2d2d2d, #252525);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #404040;
            transition: all 0.3s ease;
        }

        .format-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            border-color: #00d4ff;
        }

        .format-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .format-value {
            font-weight: 600;
            color: #00d4ff;
            text-shadow: 0 0 5px rgba(0, 212, 255, 0.3);
        }

        .preview-section {
            flex: 1;
            padding: 20px;
            overflow: hidden;
        }

        .preview-container {
            background: linear-gradient(135deg, #252525, #1f1f1f);
            border-radius: 12px;
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            border: 1px solid #404040;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .preview-tabs {
            display: flex;
            gap: 5px;
            background: #1a1a1a;
            padding: 5px;
            border-radius: 8px;
        }

        .preview-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .preview-tab.active {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 102, 204, 0.4);
        }

        .preview-tab:hover:not(.active) {
            background: #333;
            color: #ddd;
        }

        .preview-content {
            flex: 1;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            overflow: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            border: 1px solid #333;
        }

        .hex-viewer {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .hex-offset {
            color: #666;
            font-weight: bold;
        }

        .hex-data {
            color: #00ff88;
            letter-spacing: 2px;
            text-shadow: 0 0 5px rgba(0, 255, 136, 0.3);
        }

        .hex-ascii {
            color: #ffaa00;
            text-shadow: 0 0 5px rgba(255, 170, 0, 0.3);
        }

        .right-panel {
            width: 400px;
            background: linear-gradient(180deg, #252525, #1f1f1f);
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3);
        }

        .visualization-container {
            height: 350px;
            margin: 20px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #404040;
            background: #1a1a1a;
            position: relative;
        }

        #threejs-container {
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #2a2a2a 0%, #1a1a1a 100%);
        }

        .viz-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 6px;
            font-size: 11px;
            color: #00d4ff;
            backdrop-filter: blur(5px);
        }

        .analysis-section {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .analysis-container {
            background: linear-gradient(135deg, #2d2d2d, #252525);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #404040;
        }

        .analysis-grid {
            display: grid;
            gap: 12px;
            margin-top: 15px;
        }

        .analysis-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #333;
            transition: all 0.2s ease;
        }

        .analysis-row:hover {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 6px;
            padding-left: 10px;
        }

        .analysis-row:last-child {
            border-bottom: none;
        }

        .analysis-label {
            color: #888;
            font-size: 13px;
            font-weight: 500;
        }

        .analysis-value {
            color: #e0e0e0;
            font-size: 13px;
            font-weight: 600;
        }

        .threat-low { color: #4CAF50; }
        .threat-medium { color: #FF9800; }
        .threat-high { color: #F44336; }

        .status-bar {
            background: linear-gradient(135deg, #2d2d2d, #1a1a1a);
            padding: 12px 20px;
            border-top: 2px solid #404040;
            font-size: 12px;
            color: #888;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
        }

        .status-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #0099cc);
            border-radius: 3px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #444, #555);
            border-radius: 5px;
            border: 2px solid #1a1a1a;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #555, #666);
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #333;
            border-radius: 50%;
            border-top: 2px solid #00d4ff;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="app-title">Charon - Digital Forensics Tool</div>
            <div class="version-info">v2.0.0 JavaScript Edition</div>
        </div>

        <div class="menu-bar">
            <div class="menu-items">
                <div class="menu-item" onclick="showAlert('File menu')">File</div>
                <div class="menu-item" onclick="showAlert('Edit menu')">Edit</div>
                <div class="menu-item" onclick="showAlert('View menu')">View</div>
                <div class="menu-item" onclick="showAlert('Tools menu')">Tools</div>
                <div class="menu-item" onclick="showAlert('Analysis menu')">Analysis</div>
                <div class="menu-item" onclick="showAlert('Help menu')">Help</div>
            </div>
        </div>

        <div class="main-container">
            <!-- Left Panel - File Structure -->
            <div class="left-panel">
                <div class="panel-header">File Structure</div>
                <div class="file-tree" id="fileTree">
                    <!-- Files will be populated by JavaScript -->
                </div>
            </div>

            <!-- Center Panel - File Format & Preview -->
            <div class="center-panel">
                <!-- File Format Section -->
                <div class="file-format-section">
                    <div class="panel-header">File Format Information</div>
                    <div class="format-grid">
                        <div class="format-card">
                            <div class="format-label">Format</div>
                            <div class="format-value" id="formatType">E01</div>
                        </div>
                        <div class="format-card">
                            <div class="format-label">Size</div>
                            <div class="format-value" id="fileSize">2.3 GB</div>
                        </div>
                        <div class="format-card">
                            <div class="format-label">Compression</div>
                            <div class="format-value" id="compression">ZLIB</div>
                        </div>
                        <div class="format-card">
                            <div class="format-label">Hash (MD5)</div>
                            <div class="format-value" id="hashMd5">Loading...</div>
                        </div>
                        <div class="format-card">
                            <div class="format-label">Created</div>
                            <div class="format-value" id="dateCreated">2024-03-15</div>
                        </div>
                        <div class="format-card">
                            <div class="format-label">Evidence No.</div>
                            <div class="format-value" id="evidenceNo">EV-2024-001</div>
                        </div>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="preview-section">
                    <div class="preview-container">
                        <div class="preview-header">
                            <div class="panel-header">File Preview</div>
                            <div class="preview-tabs">
                                <button class="preview-tab active" onclick="switchTab('hex', this)">Hex View</button>
                                <button class="preview-tab" onclick="switchTab('text', this)">Text View</button>
                                <button class="preview-tab" onclick="switchTab('metadata', this)">Metadata</button>
                                <button class="preview-tab" onclick="switchTab('timeline', this)">Timeline</button>
                            </div>
                        </div>
                        <div class="preview-content" id="previewContent">
                            <!-- Preview content will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - 3D Model & Analysis -->
            <div class="right-panel">
                <div class="panel-header">Visualization & Analysis</div>
                
                <!-- 3D Visualization -->
                <div class="visualization-container">
                    <div id="threejs-container"></div>
                    <div class="viz-overlay">
                        <div>🎮 3D File Structure</div>
                        <div style="margin-top: 5px; font-size: 10px;">
                            Mouse: Rotate • Wheel: Zoom<br>
                            Selected: <span id="selected-file-name">disk_image.E01</span>
                        </div>
                    </div>
                </div>

                <!-- Analysis Section -->
                <div class="analysis-section">
                    <div class="analysis-container">
                        <div class="panel-header">File Analysis</div>
                        <div class="analysis-grid" id="analysisGrid">
                            <!-- Analysis data will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-content">
                <div>
                    <span class="loading-spinner"></span>
                    Processing: <span id="currentImage">disk_image.E01</span> | 
                    Files analyzed: <span id="filesAnalyzed">15,847</span> | 
                    Deleted files recovered: <span id="deletedRecovered">23</span> | 
                    Current operation: <span id="currentOperation">File signature analysis</span>
                </div>
                <div id="progressPercent">45.2%</div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 45.2%;"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'hex';
        let selectedFileIndex = 0;
        let files = [];
        let scene, camera, renderer, controls;
        let fileObjects = [];
        let animationId;

        // File structure data
        const fileStructure = [
            {
                name: '💿 disk_image.E01',
                path: '/',
                type: 'disk',
                size: 2500000000,
                format: 'E01',
                depth: 0,
                isDeleted: false,
                children: true
            },
            {
                name: '📁 Windows',
                path: '/Windows',
                type: 'folder',
                size: 15000000,
                format: 'Directory',
                depth: 1,
                isDeleted: false,
                children: true
            },
            {
                name: '📁 System32',
                path: '/Windows/System32',
                type: 'folder',
                size: 8000000,
                format: 'Directory',
                depth: 2,
                isDeleted: false,
                children: true
            },
            {
                name: '⚙️ notepad.exe',
                path: '/Windows/System32/notepad.exe',
                type: 'executable',
                size: 179712,
                format: 'PE',
                depth: 3,
                isDeleted: false,
                children: false
            },
            {
                name: '⚙️ calc.exe',
                path: '/Windows/System32/calc.exe',
                type: 'executable',
                size: 27648,
                format: 'PE',
                depth: 3,
                isDeleted: false,
                children: false
            },
            {
                name: '📁 Users',
                path: '/Users',
                type: 'folder',
                size: 5000000,
                format: 'Directory',
                depth: 1,
                isDeleted: false,
                children: true
            },
            {
                name: '👤 John',
                path: '/Users/John',
                type: 'folder',
                size: 3000000,
                format: 'Directory',
                depth: 2,
                isDeleted: false,
                children: true
            },
            {
                name: '📁 Documents',
                path: '/Users/John/Documents',
                type: 'folder',
                size: 2000000,
                format: 'Directory',
                depth: 3,
                isDeleted: false,
                children: true
            },
            {
                name: '📄 report.pdf',
                path: '/Users/John/Documents/report.pdf',
                type: 'document',
                size: 867328,
                format: 'PDF',
                depth: 4,
                isDeleted: false,
                children: false
            },
            {
                name: '🖼️ photo.jpg',
                path: '/Users/John/Documents/photo.jpg',
                type: 'image',
                size: 2097152,
                format: 'JPEG',
                depth: 4,
                isDeleted: false,
                children: false
            },
            {
                name: '📁 Program Files',
                path: '/Program Files',
                type: 'folder',
                size: 1000000000,
                format: 'Directory',
                depth: 1,
                isDeleted: false,
                children: true
            },
            {
                name: '🗑️ deleted_file.txt (recovered)',
                path: '/deleted_file.txt',
                type: 'text',
                size: 4096,
                format: 'TXT',
                depth: 1,
                isDeleted: true,
                children: false
            }
        ];

        // Initialize application
        function init() {
            files = [...fileStructure];
            populateFileTree();
            init3DVisualization();
            selectFile(0);
            startProgressAnimation();
            updateAnalysis();
            
            // Add keyboard event listeners
            document.addEventListener('keydown', handleKeyPress);
        }

        // Populate file tree
        function populateFileTree() {
            const treeContainer = document.getElementById('fileTree');
            treeContainer.innerHTML = '';

            files.forEach((file, index) => {
                const treeItem = document.createElement('div');
                treeItem.className = `tree-item ${file.isDeleted ? 'deleted' : ''}`;
                treeItem.style.marginLeft = `${file.depth * 20}px`;
                treeItem.onclick = () => selectFile(index);
                
                treeItem.innerHTML = `
                    <span class="tree-icon">${file.name.split(' ')[0]}</span>
                    <span>${file.name.substring(file.name.indexOf(' ') + 1)}</span>
                `;
                
                treeContainer.appendChild(treeItem);
            });
        }

        // Select file and update all panels
        function selectFile(index) {
            if (index < 0 || index >= files.length) return;
            
            selectedFileIndex = index;
            const file = files[index];
            
            // Update selected state in tree
            document.querySelectorAll('.tree-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
            
            // Update file format information
            updateFileFormat(file);
            
            // Update preview content
            updatePreview(file);
            
            // Update 3D visualization highlight
            update3DSelection(index);
            
            // Update analysis
            updateAnalysis(file);
            
            // Update overlay
            document.getElementById('selected-file-name').textContent = file.name.replace(/^.+?\s/, '');
        }

        // Update file format information
        function updateFileFormat(file) {
            document.getElementById('formatType').textContent = file.format;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            
            // Simulate hash calculation
            setTimeout(() => {
                const hash = generateMockHash(file.name + file.size);
                document.getElementById('hashMd5').textContent = hash;
            }, 500);
            
            document.getElementById('dateCreated').textContent = new Date().toLocaleDateString();
            
            // Set compression based on file type
            let compression = 'None';
            switch (file.format) {
                case 'JPEG': compression = 'JPEG'; break;
                case 'PDF': compression = 'Deflate'; break;
                case 'E01': compression = 'ZLIB'; break;
            }
            document.getElementById('compression').textContent = compression;
        }

        // Switch preview tabs
        function switchTab(tabName, tabElement) {
            currentTab = tabName;
            
            // Update tab appearance
            document.querySelectorAll('.preview-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            tabElement.classList.add('active');
            
            // Update preview content
            updatePreview(files[selectedFileIndex]);
        }

        // Update preview content
        function updatePreview(file) {
            const previewContent = document.getElementById('previewContent');
            
            switch (currentTab) {
                case 'hex':
                    previewContent.innerHTML = generateHexView(file);
                    break;
                case 'text':
                    previewContent.innerHTML = generateTextView(file);
                    break;
                case 'metadata':
                    previewContent.innerHTML = generateMetadataView(file);
                    break;
                case 'timeline':
                    previewContent.innerHTML = generateTimelineView(file);
                    break;
            }
        }

        // Generate hex view
        function generateHexView(file) {
            const hexData = generateMockHexData(file);
            let html = '<div class="hex-viewer">';
            
            // Generate hex display
            for (let i = 0; i < 8; i++) {
                const offset = (i * 16).toString(16).padStart(8, '0').toUpperCase();
                let hexLine = '';
                let asciiLine = '';
                
                for (let j = 0; j < 16; j++) {
                    const byteIndex = i * 16 + j;
                    const byte = hexData[byteIndex] || 0;
                    hexLine += byte.toString(16).padStart(2, '0').toUpperCase() + ' ';
                    asciiLine += (byte >= 32 && byte <= 126) ? String.fromCharCode(byte) : '.';
                }
                
                html += `
                    <div class="hex-offset">${offset}</div>
                    <div class="hex-data">${hexLine}</div>
                    <div class="hex-ascii">${asciiLine}</div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // Generate text view
        function generateTextView(file) {
            let content = '';
            switch (file.type) {
                case 'executable':
                    content = 'This program cannot be run in DOS mode.\n\nPE Executable detected.\nBinary analysis shows standard Windows executable structure.';
                    break;
                case 'document':
                    content = 'PDF Document Content:\n\nThis appears to be a text document with formatting.\nDocument contains embedded metadata and may include images.';
                    break;
                case 'image':
                    content = 'JPEG Image File\n\nImage dimensions and EXIF data would be displayed here.\nBinary image data cannot be displayed as text.';
                    break;
                case 'text':
                    content = 'Text file content would be displayed here.\n\nThis is a recovered deleted file.\nOriginal content may be partially corrupted.';
                    break;
                default:
                    content = 'Binary file content.\n\nThis file type cannot be displayed as readable text.\nUse hex view to examine raw data.';
            }
            
            return `<div style="white-space: pre-line; color: #e0e0e0; line-height: 1.8;">${content}</div>`;
        }

        // Generate metadata view
        function generateMetadataView(file) {
            const now = new Date();
            const created = new Date(now - Math.random() * 86400000 * 30); // Random date in last 30 days
            const modified = new Date(created.getTime() + Math.random() * 86400000 * 5); // Modified after creation
            const accessed = new Date(now - Math.random() * 86400000 * 2); // Recently accessed
            
            return `
                <div style="color: #e0e0e0; line-height: 2;">
                    <div style="margin-bottom: 20px;"><strong style="color: #00d4ff;">File System Metadata:</strong></div>
                    <div style="margin-left: 20px;">
                        <div><strong>Created:</strong> ${created.toLocaleString()} UTC</div>
                        <div><strong>Modified:</strong> ${modified.toLocaleString()} UTC</div>
                        <div><strong>Accessed:</strong> ${accessed.toLocaleString()} UTC</div>
                        <div><strong>Attributes:</strong> ${file.isDeleted ? 'Deleted, Archive' : 'Archive, Read-only'}</div>
                        <div><strong>Owner:</strong> ${file.type === 'executable' ? 'SYSTEM' : 'Users\\John'}</div>
                        <div><strong>Permissions:</strong> Full Control (${file.type === 'executable' ? 'SYSTEM' : 'Owner'})</div>
                        <div><strong>File Record Number:</strong> ${Math.floor(Math.random() * 99999) + 10000}</div>
                        <div><strong>Parent Directory:</strong> ${file.path.substring(0, file.path.lastIndexOf('/')) || '/'}</div>
                        <div><strong>Alternate Data Streams:</strong> ${file.isDeleted ? 'Zone.Identifier' : 'None'}</div>
                        <div><strong>Cluster Size:</strong> 4096 bytes</div>
                        <div><strong>Allocation Status:</strong> ${file.isDeleted ? 'Unallocated (Recovered)' : 'Allocated'}</div>
                    </div>
                </div>
            `;
        }

        // Generate timeline view
        function generateTimelineView(file) {
            const events = [
                { time: '2024-03-14 10:25:33', icon: '📅', event: 'File created', color: '#4CAF50' },
                { time: '2024-03-14 15:30:12', icon: '✏️', event: 'File modified', color: '#FF9800' },
                { time: '2024-03-15 08:15:45', icon: '👁️', event: 'File accessed', color: '#2196F3' },
                { time: '2024-03-15 14:22:18', icon: '🔍', event: 'Forensic analysis started', color: '#9C27B0' }
            ];
            
            if (file.isDeleted) {
                events.push({ time: '2024-03-15 16:45:22', icon: '🗑️', event: 'File deleted', color: '#F44336' });
                events.push({ time: '2024-03-15 18:12:15', icon: '🔄', event: 'File recovered', color: '#00BCD4' });
            }
            
            let html = '<div style="color: #e0e0e0; line-height: 2.2;">';
            html += '<div style="margin-bottom: 20px;"><strong style="color: #00d4ff;">File Activity Timeline:</strong></div>';
            
            events.forEach(event => {
                html += `
                    <div style="margin: 15px 0; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 4px solid ${event.color};">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 18px;">${event.icon}</span>
                            <div>
                                <div style="font-weight: bold; color: ${event.color};">${event.time}</div>
                                <div style="color: #ddd; margin-top: 4px;">${event.event}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }

        // Initialize 3D visualization
        function init3DVisualization() {
            const container = document.getElementById('threejs-container');
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
            camera.position.set(15, 10, 15);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.offsetWidth, container.offsetHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(20, 20, 20);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Create file objects
            create3DFileStructure();
            
            // Mouse controls
            setupMouseControls(container);
            
            // Start animation loop
            animate3D();
        }

        // Create 3D file structure
        function create3DFileStructure() {
            fileObjects = [];
            
            files.forEach((file, index) => {
                // Create geometry based on file type
                let geometry;
                let material;
                
                const sizeScale = Math.log10(file.size + 1) * 0.3 + 0.2;
                
                switch (file.type) {
                    case 'disk':
                        geometry = new THREE.CylinderGeometry(2, 2, 0.5, 32);
                        material = new THREE.MeshLambertMaterial({ color: 0x4CAF50 });
                        break;
                    case 'folder':
                        geometry = new THREE.BoxGeometry(sizeScale, sizeScale * 0.7, sizeScale);
                        material = new THREE.MeshLambertMaterial({ color: 0xFFEB3B });
                        break;
                    case 'executable':
                        geometry = new THREE.ConeGeometry(sizeScale * 0.7, sizeScale * 1.2, 8);
                        material = new THREE.MeshLambertMaterial({ color: 0xF44336 });
                        break;
                    case 'image':
                        geometry = new THREE.PlaneGeometry(sizeScale * 1.2, sizeScale);
                        material = new THREE.MeshLambertMaterial({ color: 0x4CAF50 });
                        break;
                    case 'document':
                        geometry = new THREE.BoxGeometry(sizeScale * 0.8, sizeScale * 1.1, sizeScale * 0.1);
                        material = new THREE.MeshLambertMaterial({ color: 0x2196F3 });
                        break;
                    case 'text':
                        geometry = new THREE.BoxGeometry(sizeScale * 0.8, sizeScale * 1.1, sizeScale * 0.05);
                        material = file.isDeleted ? 
                            new THREE.MeshLambertMaterial({ color: 0xE91E63 }) :
                            new THREE.MeshLambertMaterial({ color: 0x9E9E9E });
                        break;
                    default:
                        geometry = new THREE.SphereGeometry(sizeScale * 0.5, 16, 16);
                        material = new THREE.MeshLambertMaterial({ color: 0x9E9E9E });
                }
                
                const mesh = new THREE.Mesh(geometry, material);
                
                // Position in 3D space based on hierarchy
                const angle = index * 0.8;
                const radius = 3 + file.depth * 2;
                const height = file.depth * 1.5 - 3;
                
                mesh.position.x = radius * Math.cos(angle);
                mesh.position.z = radius * Math.sin(angle);
                mesh.position.y = height;
                
                mesh.userData = { fileIndex: index };
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                
                scene.add(mesh);
                fileObjects.push(mesh);
            });
            
            // Add ground plane
            const groundGeometry = new THREE.PlaneGeometry(50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x333333, 
                transparent: true, 
                opacity: 0.3 
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -5;
            ground.receiveShadow = true;
            scene.add(ground);
        }

        // Update 3D selection highlight
        function update3DSelection(selectedIndex) {
            fileObjects.forEach((obj, index) => {
                if (index === selectedIndex) {
                    // Highlight selected object
                    obj.material.emissive.setHex(0x444444);
                    obj.scale.set(1.3, 1.3, 1.3);
                } else {
                    // Reset other objects
                    obj.material.emissive.setHex(0x000000);
                    obj.scale.set(1, 1, 1);
                }
            });
        }

        // Setup mouse controls for 3D view
        function setupMouseControls(container) {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            container.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            container.addEventListener('mousemove', (event) => {
                if (isMouseDown) {
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;
                    
                    // Rotate camera around scene
                    const spherical = new THREE.Spherical();
                    spherical.setFromVector3(camera.position);
                    spherical.theta -= deltaX * 0.01;
                    spherical.phi += deltaY * 0.01;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                    
                    camera.position.setFromSpherical(spherical);
                    camera.lookAt(0, 0, 0);
                    
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                }
            });
            
            container.addEventListener('mouseup', () => {
                isMouseDown = false;
            });
            
            container.addEventListener('wheel', (event) => {
                const zoom = event.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(zoom);
                camera.position.clampLength(5, 50);
                event.preventDefault();
            });
            
            // Click to select objects
            container.addEventListener('click', (event) => {
                if (isMouseDown) return; // Ignore clicks during drag
                
                const rect = container.getBoundingClientRect();
                const mouse = new THREE.Vector2();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(mouse, camera);
                
                const intersects = raycaster.intersectObjects(fileObjects);
                if (intersects.length > 0) {
                    const selectedObject = intersects[0].object;
                    const fileIndex = selectedObject.userData.fileIndex;
                    selectFile(fileIndex);
                }
            });
        }

        // 3D animation loop
        function animate3D() {
            animationId = requestAnimationFrame(animate3D);
            
            // Gentle rotation of objects
            fileObjects.forEach((obj, index) => {
                obj.rotation.y += 0.005 * (index % 3 + 1);
            });
            
            renderer.render(scene, camera);
        }

        // Update analysis panel
        function updateAnalysis(file = files[selectedFileIndex]) {
            const analysisGrid = document.getElementById('analysisGrid');
            
            // Calculate analysis values
            const entropy = (Math.random() * 3 + 5).toFixed(1);
            const threatLevel = entropy > 7.5 ? 'High' : entropy > 6.0 ? 'Medium' : 'Low';
            const threatClass = entropy > 7.5 ? 'threat-high' : entropy > 6.0 ? 'threat-medium' : 'threat-low';
            
            const analysisData = [
                { label: 'File Type', value: getFileTypeDescription(file.type) },
                { label: 'Architecture', value: file.type === 'executable' ? 'x86-64' : 'N/A' },
                { label: 'Entropy', value: `${entropy}/8.0` },
                { label: 'Packed', value: entropy > 7.5 ? 'Yes' : 'No' },
                { label: 'Digital Signature', value: file.type === 'executable' ? 'Valid' : 'N/A' },
                { label: 'Threat Level', value: `<span class="${threatClass}">${threatLevel}</span>` },
                { label: 'File System', value: 'NTFS' },
                { label: 'Allocation', value: file.isDeleted ? 'Unallocated' : 'Allocated' },
                { label: 'Clusters', value: Math.ceil(file.size / 4096).toLocaleString() },
                { label: 'Slack Space', value: file.size % 4096 > 0 ? `${4096 - (file.size % 4096)} bytes` : 'None' }
            ];
            
            analysisGrid.innerHTML = analysisData.map(item => `
                <div class="analysis-row">
                    <span class="analysis-label">${item.label}</span>
                    <span class="analysis-value">${item.value}</span>
                </div>
            `).join('');
        }

        // Helper functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function generateMockHash(input) {
            let hash = 0;
            for (let i = 0; i < input.length; i++) {
                const char = input.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash).toString(16).padStart(8, '0').repeat(4).substring(0, 32);
        }

        function generateMockHexData(file) {
            const data = new Uint8Array(128);
            
            // Generate file type specific headers
            switch (file.format) {
                case 'PE': // Executable
                    data[0] = 0x4D; data[1] = 0x5A; // MZ header
                    break;
                case 'JPEG': // Image
                    data[0] = 0xFF; data[1] = 0xD8; data[2] = 0xFF; data[3] = 0xE0;
                    break;
                case 'PDF': // Document
                    data[0] = 0x25; data[1] = 0x50; data[2] = 0x44; data[3] = 0x46; // %PDF
                    break;
                default:
                    // Random data for other types
                    for (let i = 0; i < data.length; i++) {
                        data[i] = Math.floor(Math.random() * 256);
                    }
                    return data;
            }
            
            // Fill rest with random data
            for (let i = 4; i < data.length; i++) {
                data[i] = Math.floor(Math.random() * 256);
            }
            
            return data;
        }

        function getFileTypeDescription(type) {
            switch (type) {
                case 'executable': return 'PE Executable';
                case 'image': return 'JPEG Image';
                case 'document': return 'PDF Document';
                case 'folder': return 'Directory';
                case 'disk': return 'Disk Image';
                case 'text': return 'Text File';
                default: return 'Unknown';
            }
        }

        function startProgressAnimation() {
            let progress = 45.2;
            setInterval(() => {
                progress += Math.random() * 2 - 1; // Random fluctuation
                progress = Math.max(0, Math.min(100, progress));
                
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressPercent').textContent = progress.toFixed(1) + '%';
                
                // Update file count occasionally
                if (Math.random() < 0.1) {
                    const count = parseInt(document.getElementById('filesAnalyzed').textContent);
                    document.getElementById('filesAnalyzed').textContent = (count + Math.floor(Math.random() * 10)).toLocaleString();
                }
            }, 2000);
        }

        function handleKeyPress(event) {
            switch (event.key) {
                case 'ArrowUp':
                    if (selectedFileIndex > 0) {
                        selectFile(selectedFileIndex - 1);
                    }
                    event.preventDefault();
                    break;
                case 'ArrowDown':
                    if (selectedFileIndex < files.length - 1) {
                        selectFile(selectedFileIndex + 1);
                    }
                    event.preventDefault();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    const tabs = ['hex', 'text', 'metadata', 'timeline'];
                    const tabIndex = parseInt(event.key) - 1;
                    const tabElement = document.querySelectorAll('.preview-tab')[tabIndex];
                    if (tabElement) {
                        switchTab(tabs[tabIndex], tabElement);
                    }
                    break;
                case 'r':
                case 'R':
                    // Reset 3D camera
                    camera.position.set(15, 10, 15);
                    camera.lookAt(0, 0, 0);
                    break;
            }
        }

        function showAlert(message) {
            // Simple alert for menu items (can be enhanced with custom modals)
            alert(`${message} - Feature coming soon!`);
        }

        // Handle window resize
        function handleResize() {
            const container = document.getElementById('threejs-container');
            if (container && camera && renderer) {
                camera.aspect = container.offsetWidth / container.offsetHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.offsetWidth, container.offsetHeight);
            }
        }

        // Initialize application when page loads
        window.addEventListener('load', init);
        window.addEventListener('resize', handleResize);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });
    </script>
</body>
</html>